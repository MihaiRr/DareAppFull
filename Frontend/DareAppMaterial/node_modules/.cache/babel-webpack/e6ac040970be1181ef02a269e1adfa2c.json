{"ast":null,"code":"import _asyncToGenerator from \"G:/Work/DareAppFull/Frontend/DareAppMaterial/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { GoogleLoginProvider, FacebookLoginProvider } from 'angularx-social-login';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"angularx-social-login\";\nimport * as i2 from \"./shared.service\";\nexport class UserService {\n  constructor(authService, service) {\n    this.authService = authService;\n    this.service = service;\n    this.isLoggedin = false; // to be used as global user\n\n    this.localUser = {\n      isLoggedIn: false,\n      email: \"guest\",\n      username: \"Guest\",\n      userType: \"Guest\",\n      userAvatar: \"https://dare.webjuice.ro/starred.png\",\n      dareCount: 0,\n      dareTypeCount: 0\n    };\n  } //social service module login\n\n\n  syncLocalUserWithSocial() {\n    this.authService.authState.subscribe(user => {\n      console.log(user);\n      this.socialUser = user; // init plugin vars  \n\n      this.isLoggedin = user != null;\n\n      if (user != null) {\n        // init locals\n        this.localUser.isLoggedIn = true;\n        this.localUser.email = this.socialUser.email;\n        this.localUser.username = this.socialUser.name;\n        this.localUser.userType = this.socialUser.provider;\n        this.localUser.userAvatar = this.socialUser.photoUrl; // push id to backend and check if already existing + get data\n      } else {\n        this.localUser = {\n          isLoggedIn: false,\n          email: \"guest\",\n          username: \"Guest\",\n          userType: \"Guest\",\n          userAvatar: \"https://dare.webjuice.ro/starred.png\",\n          dareCount: 0,\n          dareTypeCount: 0\n        };\n      }\n    });\n  } //social service module fcts\n\n\n  signInWithGoogle() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this.authService.signIn(GoogleLoginProvider.PROVIDER_ID);\n\n      if (_this.localUser.isLoggedIn) {\n        console.log(\"Successfully logged in with Google\");\n\n        _this.service.getUserDetails(_this.localUser.email).subscribe(data => {\n          _this.localUser.dareCount = data[0].DaresDone;\n          _this.localUser.dareTypeCount = data[0].GamesPlayed;\n        });\n      }\n    })();\n  }\n\n  signInWithFB() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this2.authService.signIn(FacebookLoginProvider.PROVIDER_ID);\n\n      if (_this2.localUser.isLoggedIn) {\n        console.log(\"Successfully logged in with Facebook\");\n\n        _this2.service.getUserDetails(_this2.localUser.email).subscribe(data => {\n          _this2.localUser.dareCount = data[0].DaresDone;\n          _this2.localUser.dareTypeCount = data[0].GamesPlayed;\n        });\n      }\n    })();\n  }\n\n  signOut() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this3.authService.signOut();\n      console.log(_this3.localUser.isLoggedIn);\n\n      if (!_this3.localUser.isLoggedIn) {\n        console.log(\"Successfully logged out of social\");\n      }\n    })();\n  }\n\n  refreshToken() {\n    this.authService.refreshAuthToken(GoogleLoginProvider.PROVIDER_ID);\n\n    if (this.localUser.isLoggedIn) {\n      this.service.getUserDetails(this.localUser.email).subscribe(data => {\n        this.localUser.dareCount = data[0].DaresDone;\n        this.localUser.dareTypeCount = data[0].GamesPlayed;\n      });\n    }\n  }\n\n}\n\nUserService.ɵfac = function UserService_Factory(t) {\n  return new (t || UserService)(i0.ɵɵinject(i1.SocialAuthService), i0.ɵɵinject(i2.SharedService));\n};\n\nUserService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: UserService,\n  factory: UserService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["G:/Work/DareAppFull/Frontend/DareAppMaterial/src/app/user.service.ts"],"names":["GoogleLoginProvider","FacebookLoginProvider","i0","i1","i2","UserService","constructor","authService","service","isLoggedin","localUser","isLoggedIn","email","username","userType","userAvatar","dareCount","dareTypeCount","syncLocalUserWithSocial","authState","subscribe","user","console","log","socialUser","name","provider","photoUrl","signInWithGoogle","signIn","PROVIDER_ID","getUserDetails","data","DaresDone","GamesPlayed","signInWithFB","signOut","refreshToken","refreshAuthToken","ɵfac","UserService_Factory","t","ɵɵinject","SocialAuthService","SharedService","ɵprov","ɵɵdefineInjectable","token","factory","providedIn"],"mappings":"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","sourcesContent":["import { GoogleLoginProvider, FacebookLoginProvider } from 'angularx-social-login';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"angularx-social-login\";\r\nimport * as i2 from \"./shared.service\";\r\nexport class UserService {\r\n    constructor(authService, service) {\r\n        this.authService = authService;\r\n        this.service = service;\r\n        this.isLoggedin = false;\r\n        // to be used as global user\r\n        this.localUser = {\r\n            isLoggedIn: false,\r\n            email: \"guest\",\r\n            username: \"Guest\",\r\n            userType: \"Guest\",\r\n            userAvatar: \"https://dare.webjuice.ro/starred.png\",\r\n            dareCount: 0,\r\n            dareTypeCount: 0\r\n        };\r\n    }\r\n    //social service module login\r\n    syncLocalUserWithSocial() {\r\n        this.authService.authState.subscribe((user) => {\r\n            console.log(user);\r\n            this.socialUser = user; // init plugin vars  \r\n            this.isLoggedin = (user != null);\r\n            if (user != null) { // init locals\r\n                this.localUser.isLoggedIn = true;\r\n                this.localUser.email = this.socialUser.email;\r\n                this.localUser.username = this.socialUser.name;\r\n                this.localUser.userType = this.socialUser.provider;\r\n                this.localUser.userAvatar = this.socialUser.photoUrl;\r\n                // push id to backend and check if already existing + get data\r\n            }\r\n            else {\r\n                this.localUser = {\r\n                    isLoggedIn: false,\r\n                    email: \"guest\",\r\n                    username: \"Guest\",\r\n                    userType: \"Guest\",\r\n                    userAvatar: \"https://dare.webjuice.ro/starred.png\",\r\n                    dareCount: 0,\r\n                    dareTypeCount: 0\r\n                };\r\n            }\r\n        });\r\n    }\r\n    //social service module fcts\r\n    async signInWithGoogle() {\r\n        await this.authService.signIn(GoogleLoginProvider.PROVIDER_ID);\r\n        if (this.localUser.isLoggedIn) {\r\n            console.log(\"Successfully logged in with Google\");\r\n            this.service.getUserDetails(this.localUser.email).subscribe(data => {\r\n                this.localUser.dareCount = data[0].DaresDone;\r\n                this.localUser.dareTypeCount = data[0].GamesPlayed;\r\n            });\r\n        }\r\n    }\r\n    async signInWithFB() {\r\n        await this.authService.signIn(FacebookLoginProvider.PROVIDER_ID);\r\n        if (this.localUser.isLoggedIn) {\r\n            console.log(\"Successfully logged in with Facebook\");\r\n            this.service.getUserDetails(this.localUser.email).subscribe(data => {\r\n                this.localUser.dareCount = data[0].DaresDone;\r\n                this.localUser.dareTypeCount = data[0].GamesPlayed;\r\n            });\r\n        }\r\n    }\r\n    async signOut() {\r\n        await this.authService.signOut();\r\n        console.log(this.localUser.isLoggedIn);\r\n        if (!this.localUser.isLoggedIn) {\r\n            console.log(\"Successfully logged out of social\");\r\n        }\r\n    }\r\n    refreshToken() {\r\n        this.authService.refreshAuthToken(GoogleLoginProvider.PROVIDER_ID);\r\n        if (this.localUser.isLoggedIn) {\r\n            this.service.getUserDetails(this.localUser.email).subscribe(data => {\r\n                this.localUser.dareCount = data[0].DaresDone;\r\n                this.localUser.dareTypeCount = data[0].GamesPlayed;\r\n            });\r\n        }\r\n    }\r\n}\r\nUserService.ɵfac = function UserService_Factory(t) { return new (t || UserService)(i0.ɵɵinject(i1.SocialAuthService), i0.ɵɵinject(i2.SharedService)); };\r\nUserService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: UserService, factory: UserService.ɵfac, providedIn: 'root' });\r\n"]},"metadata":{},"sourceType":"module"}